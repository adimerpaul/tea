import{Q as h}from"./QTooltip.5611860a.js";import{_ as k,Q as d,R as u,S as r,T as o,U as t,Y as g,Z as f,aE as b,an as y,aF as Q,W as v,aC as D,aB as x,V as n,aG as S,L as A,aH as E}from"./index.8917a140.js";import{Q as C,a as U}from"./QTable.822ec9f4.js";import{a as p}from"./format.725d6b0b.js";import{Q as T}from"./QSpace.16a1aa48.js";import{Q as I,a as V}from"./QForm.886b15f6.js";import{Q as N}from"./QPage.662fc955.js";import{C as q}from"./ClosePopup.b9f7638b.js";import"./position-engine.669187e7.js";import"./QList.5624216c.js";import"./QItem.a71a40a6.js";const P={name:"ClientsIndex",data(){return{columns:[{name:"option",label:"Opciones",align:"left",field:l=>l.option},{name:"id",label:"ID",align:"left",field:l=>l.id},{name:"name",label:"Nombre",align:"left",field:l=>l.name},{name:"username",label:"Usuario",align:"left",field:l=>l.username},{name:"role",label:"Rol",align:"left",field:l=>l.role},{name:"colegio",label:"Colegio",align:"left",field:l=>{var i;return(i=l.colegio)==null?void 0:i.nombre}}],roles:[{label:"Admin",value:"ADMIN"},{label:"Tutor",value:"ATTORNEY"},{label:"Profesor",value:"TEACHER"},{label:"Asis Educ",value:"ASIS EDUC"}],loading:!1,users:[],user:{},userDialog:!1,clienDialogHistory:!1,filter:"",passwordShow:!1,colegios:[]}},mounted(){this.userGet(),this.colegioGet()},methods:{colegioGet(){this.loading=!0,this.$axios.get("colegios").then(l=>{this.colegios=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},userSave(){this.loading=!0,this.user.id?this.$axios.put(`users/${this.user.id}`,this.user).then(l=>{this.userDialog=!1;const i=this.users.findIndex(a=>a.id===this.user.id);this.users.splice(i,1,l.data)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1}):this.$axios.post("users",this.user).then(l=>{this.userDialog=!1,this.users.unshift(l.data)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},userChangePassword(l){this.$alert.promptPassword("Ingrese la nueva contrase\xF1a").onOk(i=>{this.loading=!0,this.$axios.put(`passwordUpdate/${l.id}`,{password:i}).then(a=>{this.$alert.success("Contrase\xF1a cambiada con \xE9xito")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})})},userDelete(l){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este usere?").onOk(()=>{this.loading=!0,this.$axios.delete(`users/${l.id}`).then(i=>{const a=this.users.findIndex(w=>w.id===w.id);this.users.splice(a,1)}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})})},userEdit(l){this.userDialog=!0,this.user={...l}},userAdd(){this.userDialog=!0,this.user={name:"",ci:""}},userGet(){this.loading=!0,this.$axios.get("users").then(l=>{this.users=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})}}},R={class:"text-h6"},B={class:"row"},G={class:"col-12"},O={class:"col-12"},H={class:"col-12"},Y={class:"col-12"},F={class:"col-12"};function M(l,i,a,w,s,m){return d(),u(N,{class:"bg-grey-3 q-pa-md"},{default:r(()=>[o(U,{rows:s.users,columns:s.columns,title:"Usuarios","rows-per-page-options":[0],"row-key":"id",dense:"",filter:s.filter,loading:s.loading},{"body-cell-option":r(e=>[o(C,{"auto-width":""},{default:r(()=>[o(t,{flat:"",dense:"",icon:"edit",onClick:c=>m.userEdit(e.row)},{default:r(()=>[o(h,null,{default:r(()=>[g("Editar")]),_:1})]),_:2},1032,["onClick"]),o(t,{flat:"",dense:"",icon:"delete",onClick:c=>m.userDelete(e.row)},{default:r(()=>[o(h,null,{default:r(()=>[g("Eliminar")]),_:1})]),_:2},1032,["onClick"]),o(t,{flat:"",dense:"",icon:"vpn_key",onClick:c=>m.userChangePassword(e.row)},{default:r(()=>[o(h,null,{default:r(()=>[g("Cambiar Contrase\xF1a")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),"body-cell-role":r(e=>[o(C,{props:e},{default:r(()=>[e.row.role==="ADMIN"?(d(),u(p,{key:0,dense:"",label:"Admin",color:"red","text-color":"white"})):f("",!0),e.row.role==="ATTORNEY"?(d(),u(p,{key:1,dense:"",label:"Tutor",color:"indigo","text-color":"white"})):f("",!0),e.row.role==="TEACHER"?(d(),u(p,{key:2,dense:"",label:"Profesor",color:"green","text-color":"white"})):f("",!0),e.row.role==="ASIS EDUC"?(d(),u(p,{key:3,dense:"",label:"Asis Educ",color:"orange","text-color":"white"})):f("",!0)]),_:2},1032,["props"])]),"top-right":r(()=>[o(t,{outline:"",dense:"",icon:"add_circle",onClick:m.userAdd,label:"Agregar","no-caps":"",loading:s.loading},{default:r(()=>[o(h,null,{default:r(()=>[g("Agregar")]),_:1})]),_:1},8,["onClick","loading"]),o(b,{modelValue:s.filter,"onUpdate:modelValue":i[0]||(i[0]=e=>s.filter=e),dense:"",class:"q-ml-md",debounce:"300",placeholder:"Buscar",outlined:"",clearable:""},{append:r(()=>[o(y,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-colegio":r(e=>[o(C,{"auto-width":""},{default:r(()=>{var c;return[o(p,{dense:"","text-color":"white",style:Q(`background-color: #${(c=e.row.colegio)==null?void 0:c.color}`)},{default:r(()=>{var _;return[g(v((_=e.row.colegio)==null?void 0:_.nombre),1)]}),_:2},1032,["style"])]}),_:2},1024)]),_:1},8,["rows","columns","filter","loading"]),o(E,{modelValue:s.userDialog,"onUpdate:modelValue":i[8]||(i[8]=e=>s.userDialog=e),persistent:""},{default:r(()=>[o(D,{style:{width:"250px","max-width":"90vw"}},{default:r(()=>[o(x,{class:"row items-center q-pb-none"},{default:r(()=>[n("div",R,v(s.user.id?"Editar":"Agregar")+" Cliente",1),o(T),o(t,{flat:"",dense:"",icon:"close",onClick:i[1]||(i[1]=e=>s.userDialog=!1)})]),_:1}),o(I,{onSubmit:m.userSave},{default:r(()=>[o(x,null,{default:r(()=>[n("div",B,[n("div",G,[o(b,{modelValue:s.user.name,"onUpdate:modelValue":i[2]||(i[2]=e=>s.user.name=e),label:"Nombre",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",O,[o(b,{modelValue:s.user.username,"onUpdate:modelValue":i[3]||(i[3]=e=>s.user.username=e),label:"Usuario",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",H,[s.user.id?f("",!0):(d(),u(b,{key:0,modelValue:s.user.password,"onUpdate:modelValue":i[5]||(i[5]=e=>s.user.password=e),label:"Contrase\xF1a",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"],type:s.passwordShow?"text":"password"},{append:r(()=>[o(y,{name:s.passwordShow?"visibility":"visibility_off",onClick:i[4]||(i[4]=e=>s.passwordShow=!s.passwordShow)},null,8,["name"])]),_:1},8,["modelValue","rules","type"]))]),n("div",Y,[o(V,{modelValue:s.user.role,"onUpdate:modelValue":i[6]||(i[6]=e=>s.user.role=e),label:"Rol",outlined:"",dense:"",options:s.roles,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"])]),n("div",F,[o(V,{modelValue:s.user.colegio_id,"onUpdate:modelValue":i[7]||(i[7]=e=>s.user.colegio_id=e),label:"Colegio",outlined:"",dense:"",options:s.colegios,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options","rules"])])])]),_:1}),o(S,{align:"right"},{default:r(()=>[A(o(t,{flat:"",label:"Cancelar",loading:s.loading},null,8,["loading"]),[[q]]),o(t,{color:"primary",label:"Guardar",type:"submit",loading:s.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var se=k(P,[["render",M]]);export{se as default};
