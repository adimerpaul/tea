import{_ as I,Q as p,R as c,S as d,T as t,L as h,au as b,Y as g,a2 as y,U as V,aN as i,V as n,Z as E,W as x,aD as S,aC as U,bc as Q,aO as q,aP as N,a3 as A}from"./index.ad9c98f5.js";import{a as C,b as r,d as _}from"./QMenu.565a0fcd.js";import{Q as T}from"./QList.6cc72e16.js";import{Q as O}from"./QBtnDropdown.7428b964.js";import{Q as w,a as R}from"./QTable.2ddde82a.js";import{Q as F}from"./use-fullscreen.642a52ed.js";import{Q as G}from"./QImg.39893ebc.js";import{Q as P}from"./format.5d1c2a3d.js";import{Q as B}from"./QSpace.ea0ecdd7.js";import{Q as M,a as k}from"./QForm.a0b79185.js";import{Q as L}from"./QPage.a29c6682.js";import{C as v}from"./ClosePopup.f9ca05ee.js";const H={name:"StudentsIndex.vue",data(){return{columns:[{name:"id",label:"ID",align:"left",field:l=>l.id},{name:"rut",label:"Rut",align:"left",field:l=>l.rut},{name:"name",label:"Nombre",align:"left",field:l=>l.name},{name:"email",label:"Email",align:"left",field:l=>l.email},{name:"foto",label:"Foto",align:"left",field:l=>l.foto},{name:"course",label:"Curso",align:"left",field:l=>l.course},{name:"phone",label:"Celular",align:"left",field:l=>l.phone},{name:"colegio",label:"Colegio",align:"left",field:l=>{var o;return(o=l.colegio)==null?void 0:o.nombre}},{name:"user",label:"Usuario",align:"left",field:l=>{var o;return(o=l.user)==null?void 0:o.name}},{name:"option",label:"Opciones",align:"left",field:l=>l.option}],loading:!1,students:[],student:{},studentDialog:!1,clienDialogHistory:!1,filter:"",passwordShow:!1,colegios:[],users:[]}},mounted(){this.usersGet(),this.studentGet(),this.colegiosGet()},methods:{usersGet(){this.loading=!0,this.$axios.get("users").then(l=>{this.users=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},colegiosGet(){this.loading=!0,this.$axios.get("colegios").then(l=>{this.colegios=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},studentSave(){this.loading=!0,this.student.id?this.$axios.put(`students/${this.student.id}`,this.student).then(l=>{this.studentDialog=!1;const o=this.students.findIndex(m=>m.id===this.student.id);this.students.splice(o,1,l.data)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1}):this.$axios.post("students",this.student).then(l=>{this.studentDialog=!1,this.students.unshift(l.data)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},fotoColegio(l){this.$alert.prompt("Ingrese la URL de la foto").onOk(o=>{console.log(o),this.loading=!0;const m=new FormData;m.append("file",o[0]),this.$axios.post(`fotoStudent/${l.id}`,m,{headers:{"Content-Type":"multipart/form-data"}}).then(f=>{this.$alert.success("Foto cambiada con \xE9xito");const s=this.students.find(a=>a.id===l.id);s.logo=f.data.logo}).catch(f=>{this.$alert.error(f.response.data.message)}).finally(()=>{this.loading=!1})})},studentHistory(l){this.$router.push("/students/history/"+l.id)},studentDelete(l){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este studente?").onOk(()=>{this.loading=!0,this.$axios.delete(`students/${l.id}`).then(o=>{const m=this.students.findIndex(f=>f.id===l.id);this.students.splice(m,1)}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})})},studentEdit(l){this.studentDialog=!0,this.student={...l}},studentAdd(){this.studentDialog=!0,this.student={name:"",ci:"",birthdate:"",year_PIE:"",cource:"",year:"",address:"",phone:"",sex:"M"}},studentGet(){this.loading=!0,this.$axios.get("students").then(l=>{this.students=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})}}},z=["href"],W={class:"text-h6"},Y={class:"row"},Z={class:"col-12 col-md-4"},j={class:"col-12 col-md-8"},J={class:"col-12 col-md-2"},K={class:"col-12 col-md-6"},X={class:"col-12 col-md-4"},$={class:"col-12 col-md-3"},ee={class:"col-12 col-md-3"},le={class:"col-12 col-md-3"},te={class:"col-12 col-md-3"},oe={class:"col-12 col-md-9"},se={class:"col-12 col-md-3"},de={class:"col-12 col-md-4"},ne={class:"col-12 col-md-4"},ie={class:"col-12 col-md-4"};function ae(l,o,m,f,s,a){return p(),c(L,{class:"bg-grey-3 q-pa-md"},{default:d(()=>[t(R,{rows:s.students,columns:s.columns,title:"Estudiantes","rows-per-page-options":[0],"row-key":"id",dense:"",filter:s.filter,loading:s.loading,"wrap-cells":""},{"body-cell-option":d(e=>[t(w,{"auto-width":""},{default:d(()=>[t(O,{size:"sm",label:"Opciones","no-caps":"",color:"primary"},{default:d(()=>[t(T,null,{default:d(()=>[l.$store.user.role=="ADMIN"||l.$store.user.role=="ASISTENTE EDUCATIVO"?h((p(),c(C,{key:0,clickable:"",onClick:u=>a.studentEdit(e.row)},{default:d(()=>[t(r,{avatar:""},{default:d(()=>[t(b,{name:"edit"})]),_:1}),t(r,null,{default:d(()=>[t(_,null,{default:d(()=>[g("Editar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[v]]):y("",!0),l.$store.user.role=="ADMIN"||l.$store.user.role=="ASISTENTE EDUCATIVO"?h((p(),c(C,{key:1,clickable:"",onClick:u=>a.studentDelete(e.row)},{default:d(()=>[t(r,{avatar:""},{default:d(()=>[t(b,{name:"delete"})]),_:1}),t(r,null,{default:d(()=>[t(_,null,{default:d(()=>[g("Eliminar")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[v]]):y("",!0),h((p(),c(C,{clickable:"",onClick:u=>a.studentHistory(e.row)},{default:d(()=>[t(r,{avatar:""},{default:d(()=>[t(b,{name:"history"})]),_:1}),t(r,null,{default:d(()=>[t(_,null,{default:d(()=>[g("Ficha")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[v]]),h((p(),c(C,{clickable:"",onClick:u=>a.fotoColegio(e.row)},{default:d(()=>[t(r,{avatar:""},{default:d(()=>[t(b,{name:"image"})]),_:1}),t(r,null,{default:d(()=>[t(_,null,{default:d(()=>[g("Cambio de foto")]),_:1})]),_:1})]),_:2},1032,["onClick"])),[[A]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"top-right":d(()=>{var e;return[((e=l.$store.user)==null?void 0:e.role)=="ADMIN"?(p(),c(V,{key:0,outline:"",dense:"",icon:"add_circle",onClick:a.studentAdd,label:"Agregar","no-caps":"",loading:s.loading},{default:d(()=>[t(F,null,{default:d(()=>[g("Agregar")]),_:1})]),_:1},8,["onClick","loading"])):y("",!0),t(i,{modelValue:s.filter,"onUpdate:modelValue":o[0]||(o[0]=u=>s.filter=u),dense:"",class:"q-ml-md",debounce:"300",placeholder:"Buscar",outlined:"",clearable:""},{append:d(()=>[t(b,{name:"search"})]),_:1},8,["modelValue"])]}),"body-cell-foto":d(e=>[t(w,{"auto-width":""},{default:d(()=>[n("a",{href:l.$url+"../students/"+e.row.foto,target:"_blank"},[t(G,{src:l.$url+"../students/"+e.row.foto,style:{width:"50px",height:"50px"}},null,8,["src"])],8,z)]),_:2},1024)]),"body-cell-colegio":d(e=>[t(w,{"auto-width":""},{default:d(()=>{var u;return[t(P,{dense:"","text-color":"white",style:E(`background-color: #${(u=e.row.colegio)==null?void 0:u.color}`)},{default:d(()=>{var D;return[g(x((D=e.row.colegio)==null?void 0:D.nombre),1)]}),_:2},1032,["style"])]}),_:2},1024)]),_:1},8,["rows","columns","filter","loading"]),t(N,{modelValue:s.studentDialog,"onUpdate:modelValue":o[18]||(o[18]=e=>s.studentDialog=e),persistent:""},{default:d(()=>[t(S,{style:{width:"750px","max-width":"90vw"}},{default:d(()=>[t(U,{class:"row items-center q-pb-none"},{default:d(()=>[n("div",W,x(s.student.id?"Editar":"Agregar")+" Estudiante",1),t(B),t(V,{flat:"",dense:"",icon:"close",onClick:o[1]||(o[1]=e=>s.studentDialog=!1)})]),_:1}),t(M,{onSubmit:a.studentSave},{default:d(()=>[t(U,null,{default:d(()=>[n("div",Y,[n("div",Z,[t(i,{modelValue:s.student.rut,"onUpdate:modelValue":o[2]||(o[2]=e=>s.student.rut=e),label:"Rut",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",j,[t(i,{modelValue:s.student.name,"onUpdate:modelValue":o[3]||(o[3]=e=>s.student.name=e),label:"Nombre Completo",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",J,[t(i,{modelValue:s.student.tutorRut,"onUpdate:modelValue":o[4]||(o[4]=e=>s.student.tutorRut=e),label:"Rut Tutor",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",K,[t(i,{modelValue:s.student.tutorName,"onUpdate:modelValue":o[5]||(o[5]=e=>s.student.tutorName=e),label:"Nombre Completo Tutor",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",X,[t(k,{modelValue:s.student.user_id,"onUpdate:modelValue":o[6]||(o[6]=e=>s.student.user_id=e),label:"Usuario",outlined:"",dense:"",options:s.users,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":"","option-value":"id","option-label":"name"},null,8,["modelValue","options","rules"])]),n("div",$,[t(i,{modelValue:s.student.birthdate,"onUpdate:modelValue":o[7]||(o[7]=e=>s.student.birthdate=e),label:"Fecha de Nacimiento",type:"date",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",ee,[t(i,{modelValue:s.student.year_PIE,"onUpdate:modelValue":o[8]||(o[8]=e=>s.student.year_PIE=e),label:"A\xF1o ingreso PIE",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",le,[t(k,{modelValue:s.student.course,"onUpdate:modelValue":o[9]||(o[9]=e=>s.student.course=e),label:"Curso",outlined:"",dense:"",options:l.$cursos,rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","options","rules"])]),n("div",te,[t(i,{modelValue:s.student.year,"onUpdate:modelValue":o[10]||(o[10]=e=>s.student.year=e),label:"A\xF1o",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",oe,[t(i,{modelValue:s.student.address,"onUpdate:modelValue":o[11]||(o[11]=e=>s.student.address=e),label:"Direcci\xF3n",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",se,[t(k,{modelValue:s.student.colegio_id,"onUpdate:modelValue":o[12]||(o[12]=e=>s.student.colegio_id=e),label:"Colegio",outlined:"",dense:"",options:s.colegios,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options","rules"])]),n("div",de,[t(i,{modelValue:s.student.phone,"onUpdate:modelValue":o[13]||(o[13]=e=>s.student.phone=e),type:"number",label:"Celular",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",ne,[t(i,{modelValue:s.student.email,"onUpdate:modelValue":o[14]||(o[14]=e=>s.student.email=e),label:"email",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",ie,[t(Q,{modelValue:s.student.sex,"onUpdate:modelValue":o[15]||(o[15]=e=>s.student.sex=e),val:"M",label:"Masculino"},null,8,["modelValue"]),t(Q,{modelValue:s.student.sex,"onUpdate:modelValue":o[16]||(o[16]=e=>s.student.sex=e),val:"F",label:"Femenino"},null,8,["modelValue"]),t(Q,{modelValue:s.student.sex,"onUpdate:modelValue":o[17]||(o[17]=e=>s.student.sex=e),val:"O",label:"Otro"},null,8,["modelValue"])])])]),_:1}),t(q,{align:"right"},{default:d(()=>[h(t(V,{flat:"",label:"Cancelar",loading:s.loading},null,8,["loading"]),[[v]]),t(V,{color:"primary",label:"Guardar",type:"submit",loading:s.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ve=I(H,[["render",ae]]);export{ve as default};
