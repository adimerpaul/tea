import{_ as U,Q as r,R as d,S as u,T as a,aH as F,V as t,Y as v,W as m,aC as p,aD as c,U as b,L as V,av as D,Z as A,$ as Q,a0 as N,aw as S,ax as I,a1 as C}from"./index.81674d45.js";import{Q as O,a as L}from"./QForm.58c8867a.js";import{a as x,Q as M}from"./QMarkupTable.7e83da6c.js";import{Q as P,a as y}from"./QItem.a3c85d71.js";import{Q as T,a as Y}from"./QMenu.79184c6c.js";import{m as E}from"./moment.19647928.js";const z={name:"PrestamoForm",props:{prestamoData:{type:Object,required:!0},cuotasData:{type:Array,required:!0},ciData:{type:String,required:!0},nameData:{type:String,required:!0},option:{type:String,required:!0}},data(){return{loading:!1,prestamo:this.prestamoData,cuotas:this.cuotasData,ci:this.ciData,name:this.nameData}},created(){},methods:{printPago(l){const o="https://bprestamo.siscenter.org/api/printPago/"+l.id;window.open(o,"_blank")},payAnular(l){this.loading=!0,this.$axios.put("quotaAnular/"+l.id).then(o=>{this.$alert.success("Cuota anulada con exito"),this.cuotas=o.data.quotas,this.prestamo.status=o.data.status}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},pay(l){this.loading=!0,this.$axios.put("quotaPay/"+l.id).then(o=>{this.$alert.success("Cuota pagada con exito"),this.cuotas=o.data.quotas,this.prestamo.status=o.data.status}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},descriptionUpdate(l){this.option==="show"&&this.$axios.put("loanDescriptionUpdate/"+this.prestamo.id,{description:l}).then(o=>{})},printCompromiso(){const l="https://bprestamo.siscenter.org/api/compromiso/"+this.prestamo.id;window.open(l,"_blank")},printPlan(){const l="https://bprestamo.siscenter.org/api/plan/"+this.prestamo.id;window.open(l,"_blank")},anularPrestamo(){this.$alert.confirm("Esta seguro de anular el prestamo?").onOk(()=>{this.loading=!0,this.$axios.put("loansAnular/"+this.prestamo.id,{status:"ANULADO"}).then(l=>{this.$alert.success("Prestamo anulado con exito"),this.$router.push("/prestamos")}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})})},formatDateDmy(l){const o=["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],i=l.split("-")[2],g=o[parseInt(l.split("-")[1])-1],s=l.split("-")[0];return`${i}-${g}-${s}`},loan(){if(this.cuotas.length===0)return this.$alert.error("Primero debe calcular las cuotas"),!1;if(this.ci==="")return this.$alert.error("Primero debe buscar el cliente"),!1;if(this.name==="")return this.$alert.error("Primero debe buscar el cliente"),!1;this.loading=!0,this.$axios.post("loans",{...this.prestamo,cuotas:this.cuotas,ci:this.ci,name:this.name}).then(l=>{this.$alert.success("Prestamo guardado con exito"),this.$router.push("/prestamos/"+l.data.id)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},calculate(){let l=this.prestamo.amount;const o=this.prestamo.payments,i=this.prestamo.interest_rate,g=this.prestamo.custodial_fee,s=this.prestamo.currency;this.cuotas=[];let n=0,e=0,h=0,_=0,w=0;const f=l/o;let k=E(this.prestamo.date).format("YYYY-MM-DD");for(let q=0;q<o;q++)h=l*i/100,_=l*g/100,e=h+_+f,s==="DOLARES"?n=e*this.prestamo.dolar:n=e,w=Math.round((l-f)*100)/100,k=E(k).add(1,"months").format("YYYY-MM-DD"),this.cuotas.push({amount:parseFloat(l).toFixed(2),interest:h.toFixed(2),custodial_fee:_.toFixed(2),capital:f.toFixed(2),saldo:w.toFixed(2),total_bs:n.toFixed(2),date:k}),l-=f},clientSearch(){this.loading=!0,this.$axios.get("clients/search",{params:{ci:this.ci}}).then(l=>{l.data!==""&&(this.name=l.data[0].name)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},submit(){}}},B={class:"row"},G={class:"col-6 col-md-1 q-pa-xs"},R={class:"text-h6 text-red flex flex-center",style:{"line-height":"1"}},j=t("b",null,"Id:",-1),H={class:"col-6 col-md-3 q-pa-xs"},W={class:"col-6 col-md-2 q-pa-xs"},Z={class:"col-6 col-md-6 q-pa-xs"},J={class:"col-6 col-md-3 q-pa-xs"},K={class:"col-6 col-md-3 q-pa-xs"},X={class:"col-6 col-md-3 q-pa-xs flex flex-center"},$={class:"col-12 col-md-12 q-pa-xs"},ee={class:"col-6 col-md-2 q-pa-xs"},te={class:"col-6 col-md-2 q-pa-xs"},oe={class:"col-6 col-md-2 q-pa-xs"},se={class:"col-6 col-md-2 q-pa-xs"},le={class:"col-6 col-md-2 flex flex-center"},ae={class:"col-6 col-md-2 flex flex-center"},ie={class:"col-12"},re=t("thead",null,[t("tr",null,[t("th",null,[t("div",{class:"text-bold"},"#")]),t("th",null,[t("div",{class:"text-bold"},"Opcion")]),t("th",null,[t("div",{class:"text-bold"},"#Estado")]),t("th",null,[t("div",{class:"text-bold"},"Saldo Inicial")]),t("th",null,[t("div",{class:"text-bold"},"Interes")]),t("th",null,[t("div",{class:"text-bold"},"Custodia")]),t("th",null,[t("div",{class:"text-bold"},"Capital")]),t("th",null,[t("div",{class:"text-bold"},"Total")]),t("th",null,[t("div",{class:"text-bold"},"Saldo Final")]),t("th",null,[t("div",{class:"text-bold"},"Total A Pagar")]),t("th",null,[t("div",{class:"text-bold"},"Fecha")])])],-1),ne={class:"text-right"},de={class:"text-right"},ue={class:"text-right"},ce={class:"text-right"},me={class:"text-right"},pe={class:"text-right"},he={class:"text-right"},_e={class:"text-right"},be={class:"text-right"},xe={class:"text-right"};function ye(l,o,i,g,s,n){return r(),d(I,null,{default:u(()=>[a(S,null,{default:u(()=>[a(O,{onSubmit:F(n.submit,["prevent"])},{default:u(()=>[t("div",B,[t("div",G,[t("div",R,[j,v(" "+m(s.prestamo.id),1)])]),t("div",H,[a(p,{modelValue:s.prestamo.date,"onUpdate:modelValue":o[0]||(o[0]=e=>s.prestamo.date=e),outlined:"",dense:"",label:"Fecha",type:"date",readonly:i.option==="show"},null,8,["modelValue","readonly"])]),t("div",W,[a(p,{modelValue:s.ci,"onUpdate:modelValue":[o[1]||(o[1]=e=>s.ci=e),n.clientSearch],outlined:"",dense:"",label:"C.I.",debounce:"500",rules:[e=>!!e||"La cedula de identidad es requerida"],readonly:i.option==="show"},null,8,["modelValue","onUpdate:modelValue","rules","readonly"])]),t("div",Z,[a(p,{modelValue:s.name,"onUpdate:modelValue":o[2]||(o[2]=e=>s.name=e),outlined:"",dense:"",label:"Nombre",rules:[e=>!!e||"El nombre es requerido"],readonly:i.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",J,[a(L,{modelValue:s.prestamo.currency,"onUpdate:modelValue":o[3]||(o[3]=e=>s.prestamo.currency=e),outlined:"",dense:"",label:"Moneda",options:["DOLARES","BOLIVIANOS"],readonly:i.option==="show"},null,8,["modelValue","readonly"])]),t("div",K,[a(p,{modelValue:s.prestamo.dolar,"onUpdate:modelValue":o[4]||(o[4]=e=>s.prestamo.dolar=e),outlined:"",dense:"",label:"Dolar",type:"number",step:"0.01",rules:[e=>!!e||"El dolar es requerido",e=>e>0||"El dolar debe ser mayor a 0"],readonly:i.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",X,[s.prestamo.status==="PENDIENTE"?(r(),d(x,{key:0,color:"orange","text-color":"white",label:"Pendiente"})):c("",!0),s.prestamo.status==="PAGADO"?(r(),d(x,{key:1,color:"positive","text-color":"white",label:"Pagado"})):c("",!0),s.prestamo.status==="ANULADO"?(r(),d(x,{key:2,color:"negative","text-color":"white",label:"Anulado"})):c("",!0)]),t("div",$,[a(p,{type:"textarea",modelValue:s.prestamo.description,"onUpdate:modelValue":[o[5]||(o[5]=e=>s.prestamo.description=e),n.descriptionUpdate],outlined:"",dense:"",label:"Descripcion",debounce:1e3},null,8,["modelValue","onUpdate:modelValue"])]),t("div",ee,[a(p,{modelValue:s.prestamo.amount,"onUpdate:modelValue":o[6]||(o[6]=e=>s.prestamo.amount=e),outlined:"",dense:"",label:"Monto",type:"number",rules:[e=>!!e||"El monto es requerido",e=>e>0||"El monto debe ser mayor a 0"],readonly:i.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",te,[a(p,{modelValue:s.prestamo.interest_rate,"onUpdate:modelValue":o[7]||(o[7]=e=>s.prestamo.interest_rate=e),outlined:"",dense:"",label:"Interes %",type:"number",rules:[e=>!!e||"El interes es requerido",e=>e>0||"El interes debe ser mayor a 0"],readonly:i.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",oe,[a(p,{modelValue:s.prestamo.custodial_fee,"onUpdate:modelValue":o[8]||(o[8]=e=>s.prestamo.custodial_fee=e),outlined:"",dense:"",label:"Custodia %",type:"number",rules:[e=>!!e||"La custodia es requerida",e=>e>0||"La custodia debe ser mayor a 0"],readonly:i.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",se,[a(p,{modelValue:s.prestamo.payments,"onUpdate:modelValue":o[9]||(o[9]=e=>s.prestamo.payments=e),outlined:"",dense:"",label:"Pagos",type:"number",rules:[e=>!!e||"El numero de pagos es requerido",e=>e>0||"El numero de pagos debe ser mayor a 0"],readonly:i.option==="show"},null,8,["modelValue","rules","readonly"])]),t("div",le,[i.option==="create"?(r(),d(b,{key:0,color:"primary",label:"Calcular",type:"submit",loading:s.loading,"no-caps":"",size:"12px",class:"text-bold",icon:"o_calculate",onClick:n.calculate},null,8,["loading","onClick"])):c("",!0)]),t("div",ae,[i.option==="create"?(r(),d(b,{key:0,color:"green",label:"Guardar",type:"submit",loading:s.loading,"no-caps":"",size:"12px",class:"text-bold",icon:"o_save",onClick:n.loan},null,8,["loading","onClick"])):c("",!0),i.option==="show"?(r(),d(b,{key:1,color:"indigo",label:"Opciones",loading:s.loading,"no-caps":"",size:"12px",class:"text-bold",icon:"o_settings"},{default:u(()=>[a(T,null,{default:u(()=>[a(Y,null,{default:u(()=>[V((r(),d(P,{clickable:"",onClick:n.printCompromiso},{default:u(()=>[a(y,{avatar:""},{default:u(()=>[a(D,{name:"o_print"})]),_:1}),a(y,null,{default:u(()=>[v("Compromiso de pago")]),_:1})]),_:1},8,["onClick"])),[[C]]),V((r(),d(P,{clickable:"",onClick:n.printPlan},{default:u(()=>[a(y,{avatar:""},{default:u(()=>[a(D,{name:"o_print"})]),_:1}),a(y,null,{default:u(()=>[v("Plan de pago")]),_:1})]),_:1},8,["onClick"])),[[C]]),s.prestamo.status==="PENDIENTE"?V((r(),d(P,{key:0,clickable:"",onClick:n.anularPrestamo},{default:u(()=>[a(y,{avatar:""},{default:u(()=>[a(D,{name:"o_block"})]),_:1}),a(y,null,{default:u(()=>[v("Anular prestamo")]),_:1})]),_:1},8,["onClick"])),[[C]]):c("",!0)]),_:1})]),_:1})]),_:1},8,["loading"])):c("",!0)]),t("div",ie,[a(M,{dense:"","wrap-cells":"",flat:"",bordered:"",separator:"cell"},{default:u(()=>[re,t("tbody",null,[(r(!0),A(N,null,Q(s.cuotas,(e,h)=>(r(),A("tr",{key:h},[t("td",ne,m(h+1),1),t("td",de,[i.option==="show"&&e.status==="PAGADO"?(r(),d(b,{key:0,color:"red",label:"Anular",dense:"","no-caps":"",size:"12px",class:"text-bold",icon:"o_block",onClick:_=>n.payAnular(e),loading:s.loading},null,8,["onClick","loading"])):c("",!0),i.option==="show"&&e.isLast&&s.prestamo.status==="PENDIENTE"?(r(),d(b,{key:1,color:"positive",label:"Pagar",dense:"","no-caps":"",size:"12px",class:"text-bold",icon:"o_payment",onClick:_=>n.pay(e),loading:s.loading},null,8,["onClick","loading"])):c("",!0)]),t("td",ue,[e.status==="PENDIENTE"?(r(),d(x,{key:0,dense:"",color:"orange","text-color":"white",label:"Pendiente"})):c("",!0),e.status==="PAGADO"?(r(),d(b,{key:1,dense:"",flat:"",color:"indigo",round:"",size:"12px",class:"text-bold",icon:"o_print",onClick:_=>n.printPago(e)},null,8,["onClick"])):c("",!0),e.status==="PAGADO"?(r(),d(x,{key:2,dense:"",color:"positive","text-color":"white",label:"Pagado"})):c("",!0),e.status==="ANULADO"?(r(),d(x,{key:3,dense:"",color:"negative","text-color":"white",label:"Anulado"})):c("",!0)]),t("td",ce,m(e.amount),1),t("td",me,m(e.interest),1),t("td",pe,m(e.custodial_fee),1),t("td",he,m(e.capital),1),t("td",_e,m((parseFloat(e.interest)+parseFloat(e.custodial_fee)+parseFloat(e.capital)).toFixed(2)),1),t("td",be,m(e.saldo),1),t("td",xe,m(e.total_bs),1),t("td",null,m(n.formatDateDmy(e.date)),1)]))),128))])]),_:1})])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var Ce=U(z,[["render",ye]]);export{Ce as P};
