import{_ as E,Q as h,R as g,S as n,T as s,V as e,U as m,$ as y,a0 as k,a1 as V,aA as f,aB as _,aD as p,Z as w,aE as U,aF as O,W as a,Y as x,P as S,ba as b,am as P}from"./index.a5dd7250.js";import{Q as C,d as L,b as F,a as R,f as T}from"./QForm.4522b36b.js";import{Q}from"./QBtnGroup.b91aa6b3.js";import{a as I,c as D,d as A}from"./format.c253e486.js";import{Q as M}from"./QPage.994b841f.js";import"./position-engine.9b04c1d2.js";const H={props:{student_id:{type:Number,required:!0}},data(){return{loading:!1,documentsSelect:["AUTORIZACI\xD3N PARA EL ABORDAJE DEC.","CERTIFICADO PARA EL EMPLEADOR","CONTRATO DE CONTIGENCIAS","FICHA DEL PLAN DE APOYO INDIVIDUALIZADO (PAI) PARA ESTUDIANTES CON TEA","PLAN DE ACOMPA\xD1AMIENTO EMOCIONAL Y CONDUCTUAL","FICHA DE SEGUIMIENTO INDIVIDUALIZADA PARA DESREGULACI\xD3N EMOCIONAL"],documentDialog:!1,document:{},documents:[]}},mounted(){this.documentsGet()},methods:{documentDelete(o){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este document?").onOk(()=>{this.loading=!0,this.$axios.delete(`documents/${o.id}`).then(t=>{this.$alert.success("Documento eliminado"),this.documentsGet()}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})})},documentOpen(o){this.loading=!0,this.$axios.get(`documents/${o.id}/download`,{responseType:"blob"}).then(t=>{const r=window.URL.createObjectURL(new Blob([t.data],{type:"application/pdf"})),u=window.document.createElement("a");u.href=r,u.setAttribute("download",`${o.description}.pdf`),window.document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(r)}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},documentsGet(){this.loading=!0,this.$axios.get("documents",{params:{student_id:this.student_id}}).then(o=>{this.documents=o.data,console.log(this.documents)}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},documentForm(){this.loading=!0,this.$axios.post("documents",{student_id:this.student_id,document:this.document}).then(o=>{this.$alert.success("Documento agregado"),this.documentDialog=!1,this.documentsGet()}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},addDocument(){this.documentDialog=!0,this.document={}}}},q={class:"row items-center"},G=e("div",{class:"text-h6 text-bold"},"Documentos",-1),B=e("thead",null,[e("tr",null,[e("th",null,"Opciones"),e("th",null,"Fecha"),e("th",null,"Documento"),e("th",null,"Usuario")])],-1),z=e("div",{class:"text-h6 text-bold"},"Agregar Documento",-1),Y={key:1,class:"row"},Z={class:"col-12"},j={class:"col-12 col-md-4"},J={class:"col-12 col-md-4"},W={class:"col-12 col-md-4"},K={class:"col-6 col-md-3"},X={class:"col-6 col-md-3"},$={class:"col-6 col-md-3"},ee={class:"col-6 col-md-3"};function te(o,t,r,u,l,c){return h(),g(_,null,{default:n(()=>[s(f,null,{default:n(()=>[e("div",q,[G,s(C),s(m,{icon:"add_circle_outline",onClick:c.addDocument,label:"Agregar","no-caps":"",color:"indigo",dense:"",size:"10px",loading:l.loading},null,8,["onClick","loading"])]),s(L,{dense:"","wrap-cells":""},{default:n(()=>[B,e("tbody",null,[(h(!0),y(V,null,k(l.documents,i=>{var d;return h(),y("tr",{key:i.id},[e("td",null,[s(m,{icon:"edit",flat:"",round:"",dense:"",color:"primary",loading:l.loading},null,8,["loading"]),s(m,{icon:"delete",flat:"",round:"",dense:"",color:"negative",onClick:v=>c.documentDelete(i),loading:l.loading},null,8,["onClick","loading"])]),e("td",null,a(o.$filters.formatdMYHMS(i.date)),1),e("td",null,[s(m,{flat:"",dense:"",onClick:v=>c.documentOpen(i),icon:"fa-solid fa-file",size:"12px",color:"blue-9",loading:l.loading},null,8,["onClick","loading"]),x(" "+a(i.description),1)]),e("td",null,a((d=i.user)==null?void 0:d.name),1)])}),128))])]),_:1})]),_:1}),s(O,{modelValue:l.documentDialog,"onUpdate:modelValue":t[12]||(t[12]=i=>l.documentDialog=i),persistent:""},{default:n(()=>[s(_,{style:{width:"750px","max-width":"90vw",height:"90vh","max-height":"90vh"}},{default:n(()=>[s(f,{class:"row items-center q-pb-none"},{default:n(()=>[z,s(C),s(m,{icon:"close",flat:"",round:"",dense:"",onClick:t[0]||(t[0]=i=>l.documentDialog=!1)})]),_:1}),s(f,null,{default:n(()=>[s(F,{modelValue:l.document.name,"onUpdate:modelValue":t[1]||(t[1]=i=>l.document.name=i),options:l.documentsSelect,label:"Seleccionar Documento",outlined:"",dense:""},null,8,["modelValue","options"]),s(R,{onSubmit:c.documentForm},{default:n(()=>[l.document.name==="AUTORIZACI\xD3N PARA EL ABORDAJE DEC."?(h(),g(p,{key:0,label:"Descripci\xF3n",modelValue:l.document.description,"onUpdate:modelValue":t[2]||(t[2]=i=>l.document.description=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])):l.document.name==="CERTIFICADO PARA EL EMPLEADOR"?(h(),y("div",Y,[e("div",Z,[s(p,{label:"Descripci\xF3n",modelValue:l.document.description,"onUpdate:modelValue":t[3]||(t[3]=i=>l.document.description=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])]),e("div",j,[s(p,{label:"Etapa Inicial",modelValue:l.document.etapa_inial,"onUpdate:modelValue":t[4]||(t[4]=i=>l.document.etapa_inial=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])]),e("div",J,[s(p,{label:"Aumento",modelValue:l.document.aumento,"onUpdate:modelValue":t[5]||(t[5]=i=>l.document.aumento=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])]),e("div",W,[s(p,{label:"Crisis",modelValue:l.document.crisis,"onUpdate:modelValue":t[6]||(t[6]=i=>l.document.crisis=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])]),e("div",K,[s(p,{label:"Hora Inicio",modelValue:l.document.hora_inicio,"onUpdate:modelValue":t[7]||(t[7]=i=>l.document.hora_inicio=i),outlined:"",dense:"",type:"time"},null,8,["modelValue"])]),e("div",X,[s(p,{label:"Hora Llamada",modelValue:l.document.hora_llamada,"onUpdate:modelValue":t[8]||(t[8]=i=>l.document.hora_llamada=i),outlined:"",dense:"",type:"time"},null,8,["modelValue"])]),e("div",$,[s(p,{label:"Hora Llegada",modelValue:l.document.hora_llegada,"onUpdate:modelValue":t[9]||(t[9]=i=>l.document.hora_llegada=i),outlined:"",dense:"",type:"time"},null,8,["modelValue"])]),e("div",ee,[s(p,{label:"Hora Termino",modelValue:l.document.hora_termino,"onUpdate:modelValue":t[10]||(t[10]=i=>l.document.hora_termino=i),outlined:"",dense:"",type:"time"},null,8,["modelValue"])])])):w("",!0),s(U,{align:"right"},{default:n(()=>[s(m,{label:"Cancelar",color:"negative",onClick:t[11]||(t[11]=i=>l.documentDialog=!1),loading:l.loading,icon:"close","no-caps":""},null,8,["loading"]),s(m,{label:"Guardar",color:"primary",type:"submit",loading:l.loading,icon:"save","no-caps":""},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var le=E(H,[["render",te]]);const se={name:"StudentsHistory",components:{StudentsDocuments:le},data(){return{student_id:this.$route.params.id,student:{},process:0,textProcess:"",loading:!1,historyDialog:!1,history:{description:""}}},mounted(){this.student_id=this.$route.params.id,this.studentGet()},methods:{deleteHistory(o){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este historial?").onOk(()=>{this.loading=!0,this.$axios.delete(`history/${o}`).then(t=>{const r=this.student.histories.findIndex(u=>u.id===o);this.student.histories.splice(r,1)}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})})},historyClick(o){this.history={...o},this.historyDialog=!0},historyForm(){this.loading=!0,this.history.student_id=this.student_id,this.history.id?this.$axios.put(`history/${this.history.id}`,this.history).then(o=>{const t=this.student.histories.findIndex(r=>r.id===this.history.id);this.student.histories.splice(t,1,o.data),this.historyDialog=!1}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1}):this.$axios.post("history/",this.history).then(o=>{this.student.histories.unshift(o.data),this.historyDialog=!1}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},addHistory(){this.historyDialog=!0,this.history.id=void 0,this.history.description=""},handleDrop(o){o.preventDefault();const t=o.dataTransfer.files;this.processFiles(t)},processFiles(o){this.fileUpload(o)},uploadFile(){this.$refs.fileInput.click()},fileUpload(){const o=new FormData;o.append("file",this.$refs.fileInput.files[0]),o.append("student_id",this.student_id);const t={onUploadProgress:r=>{const u=Math.round(r.loaded*100/r.total);this.textProcess=u+"% completado",this.process=u/100}};this.$axios.post(`students/${this.student_id}/diagnoses`,o,t).then(r=>{this.student.diagnoses.unshift(r.data)}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.$refs.fileInput.value="",this.textProcess=""})},studentGet(){this.$axios.get(`students/${this.student_id}`).then(o=>{this.student=o.data}).catch(o=>{this.$alert.error(o.response.data.message)})},downloadFile(o){this.loading=!0,this.$axios.get(`diagnoses/${o.id}/download`,{responseType:"blob"}).then(t=>{const r=window.URL.createObjectURL(new Blob([t.data],{type:t.headers["content-type"]})),u=document.createElement("a");u.href=r,u.setAttribute("download",o.name),document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(r)}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},deleteDiagnosis(o){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este diagn\xF3stico?").onOk(()=>{this.loading=!0,this.$axios.delete(`diagnoses/${o}`).then(t=>{const r=this.student.diagnoses.findIndex(u=>u.id===o);this.student.diagnoses.splice(r,1)}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})})}}},oe={class:"row"},ne={class:"col-12 col-md-3"},ie=e("label",{class:"text-bold"},"Rut",-1),de={class:"col-12 col-md-9"},ae=e("label",{class:"text-bold"},"Nombre Completo",-1),re={class:"col-6 col-md-3"},ue=e("label",{class:"text-bold"},"Rut Tutor",-1),ce={class:"col-6 col-md-9"},me=e("label",{class:"text-bold"},"Nombre Tutor",-1),he={class:"col-6 col-md-3"},pe=e("label",{class:"text-bold"},"Fecha de Nacimiento",-1),fe={class:"col-6 col-md-3"},_e=e("label",{class:"text-bold"},"A\xF1o ingreso PIE",-1),ge={class:"col-6 col-md-3"},ve=e("label",{class:"text-bold"},"Curso",-1),ye={class:"col-6 col-md-3"},be=e("label",{class:"text-bold"},"A\xF1o",-1),De={class:"col-12"},xe=e("label",{class:"text-bold"},"Direcci\xF3n",-1),Ce={class:"col-6 col-md-6"},Ae=e("label",{class:"text-bold"},"Celular",-1),ke={class:"col-6 col-md-6"},Ve=e("label",{class:"text-bold"},"Sexo",-1),Ie={class:"row"},Ee={class:"col-12 col-md-8"},we={class:"row"},Ue={class:"col-12"},Oe={class:"row items-center"},Le=e("div",{class:"text-h6 text-bold"},"Historial",-1),Re=e("thead",null,[e("tr",null,[e("th",null,"Opciones"),e("th",null,"Fecha"),e("th",null,"Descripci\xF3n"),e("th",null,"Usuario")])],-1),Ne={class:"col-12"},Se={class:"col-12 col-md-4"},Pe=e("div",{class:"text-h6"},"Diagn\xF3sticos",-1),Fe=e("div",null,"Ac\xE1 suba sus archivos",-1),Te={class:"q-mt-md"},Qe={class:"text-h6"};function Me(o,t,r,u,l,c){const i=S("StudentsDocuments");return h(),g(M,{class:"bg-grey-3 q-pa-md"},{default:n(()=>[s(_,{class:"q-mb-md"},{default:n(()=>[s(f,null,{default:n(()=>[e("div",oe,[e("div",ne,[ie,e("div",null,a(l.student.rut),1)]),e("div",de,[ae,e("div",null,a(l.student.name),1)]),e("div",re,[ue,e("div",null,a(l.student.tutorRut),1)]),e("div",ce,[me,e("div",null,a(l.student.tutorName),1)]),e("div",he,[pe,e("div",null,a(l.student.birthdate),1)]),e("div",fe,[_e,e("div",null,a(l.student.year_PIE),1)]),e("div",ge,[ve,e("div",null,a(l.student.course),1)]),e("div",ye,[be,e("div",null,a(l.student.year),1)]),e("div",De,[xe,e("div",null,a(l.student.address),1)]),e("div",Ce,[Ae,e("div",null,a(l.student.phone),1)]),e("div",ke,[Ve,e("div",null,a(l.student.sex==="M"?"Masculino":"Femenino"),1)])])]),_:1})]),_:1}),e("div",Ie,[e("div",Ee,[e("div",we,[e("div",Ue,[s(_,null,{default:n(()=>[s(f,null,{default:n(()=>[e("div",Oe,[Le,s(C),s(m,{icon:"add_circle_outline",onClick:c.addHistory,label:"Agregar","no-caps":"",color:"green",dense:"",size:"10px"},null,8,["onClick"])]),s(L,{dense:"","wrap-cells":""},{default:n(()=>[Re,e("tbody",null,[(h(!0),y(V,null,k(l.student.histories,d=>{var v;return h(),y("tr",{key:d.id},[e("td",null,[s(Q,{rounded:""},{default:n(()=>[s(m,{flat:"",icon:"edit",class:"q-pa-xs",size:"10px",onClick:N=>c.historyClick(d)},null,8,["onClick"]),s(m,{flat:"",icon:"delete",class:"q-pa-xs",size:"10px",onClick:N=>c.deleteHistory(d.id)},null,8,["onClick"])]),_:2},1024)]),e("td",null,a(o.$filters.formatdMY(d.date)),1),e("td",null,a(d.description),1),e("td",null,a((v=d.user)==null?void 0:v.name),1)])}),128))])]),_:1})]),_:1})]),_:1})]),e("div",Ne,[s(i,{student_id:parseInt(l.student_id)},null,8,["student_id"])])])]),e("div",Se,[s(_,null,{default:n(()=>[s(f,null,{default:n(()=>[Pe,e("div",{class:"text-center border-dashed cursor-pointer",onClick:t[0]||(t[0]=(...d)=>c.uploadFile&&c.uploadFile(...d)),onDragenter:t[1]||(t[1]=b(()=>{},["prevent"])),onDragover:t[2]||(t[2]=b(()=>{},["prevent"])),onDragleave:t[3]||(t[3]=b(()=>{},["prevent"])),onDrop:t[4]||(t[4]=b((...d)=>c.handleDrop&&c.handleDrop(...d),["prevent"]))},[s(P,{name:"cloud_upload",size:"70px"}),Fe],32),e("input",{type:"file",class:"hidden",ref:"fileInput",onChange:t[5]||(t[5]=(...d)=>c.fileUpload&&c.fileUpload(...d)),accept:".pdf"},null,544),e("div",Te,[s(_,null,{default:n(()=>[s(f,{class:"q-pa-none"},{default:n(()=>[l.textProcess!==""?(h(),g(I,{key:0},{default:n(()=>[s(D,null,{default:n(()=>[s(A,null,{default:n(()=>[x(a(l.textProcess),1)]),_:1}),s(T,{value:l.process,color:l.process===100?"green":"primary"},null,8,["value","color"])]),_:1}),s(D,{side:""},{default:n(()=>[s(m,{flat:"",icon:"picture_as_pdf"})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),(h(!0),y(V,null,k(l.student.diagnoses,d=>(h(),g(_,{key:d.id,flat:"",bordered:"",class:"q-ma-sm"},{default:n(()=>[s(f,{class:"q-pa-none bg-grey-3"},{default:n(()=>[s(I,null,{default:n(()=>[s(D,{clickable:""},{default:n(()=>[s(A,{class:"text-bold"},{default:n(()=>[x(a(o.$filters.formatdMY(d.created_at))+" ",1),s(m,{flat:"",icon:"fa-regular fa-file-pdf",dense:"",class:"q-pa-none",color:"red",size:"10px",onClick:v=>c.downloadFile(d),loading:l.loading},null,8,["onClick","loading"])]),_:2},1024),s(A,{class:"text-capitalize text-caption"},{default:n(()=>[x(a(d.name),1)]),_:2},1024)]),_:2},1024),s(D,{side:""},{default:n(()=>[s(m,{flat:"",icon:"delete",onClick:v=>c.deleteDiagnosis(d.id),color:"red",loading:l.loading},null,8,["onClick","loading"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})]),_:1})])]),s(O,{modelValue:l.historyDialog,"onUpdate:modelValue":t[9]||(t[9]=d=>l.historyDialog=d)},{default:n(()=>[s(_,{style:{width:"400px","max-width":"90vw"}},{default:n(()=>[s(f,{class:"row items-center q-pb-none"},{default:n(()=>[e("div",Qe,a(l.history.id?"Editar":"Agregar")+" Historial ",1),s(C),s(m,{flat:"",icon:"close",onClick:t[6]||(t[6]=d=>l.historyDialog=!1)})]),_:1}),s(f,null,{default:n(()=>[s(R,{class:"q-gutter-md",onSubmit:c.historyForm},{default:n(()=>[s(p,{type:"textarea",modelValue:l.history.description,"onUpdate:modelValue":t[7]||(t[7]=d=>l.history.description=d),label:"Descripci\xF3n",outlined:"",rules:[d=>!!d||"Campo requerido"]},null,8,["modelValue","rules"]),s(U,{align:"right"},{default:n(()=>[s(m,{label:"Cancelar",color:"red",onClick:t[8]||(t[8]=d=>l.historyDialog=!1),"no-caps":"",icon:"close",loading:l.loading},null,8,["loading"]),l.history.id===void 0?(h(),g(m,{key:0,label:"Guardar",color:"green",type:"submit","no-caps":"",icon:"save",loading:l.loading},null,8,["loading"])):(h(),g(m,{key:1,label:"Modificar",color:"orange",type:"submit","no-caps":"",icon:"save",loading:l.loading},null,8,["loading"]))]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ze=E(se,[["render",Me]]);export{Ze as default};
