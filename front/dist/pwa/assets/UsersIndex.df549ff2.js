import{Q as c}from"./use-fullscreen.d1f74c28.js";import{_ as x,Q as g,R as C,S as i,T as s,U as d,Y as u,Z as _,W as f,aN as p,au as v,V as r,$ as y,a0 as Q,a1 as k,aD as A,aC as D,a2 as S,aO as I,L as N,aP as U}from"./index.05beb885.js";import{Q as h,a as O}from"./QTable.a927dba0.js";import{Q as V}from"./format.2dbef468.js";import{Q as P}from"./QSpace.d4dea15a.js";import{Q as T,a as E}from"./QForm.ef2bde9b.js";import{Q as q}from"./QPage.7636a733.js";import{C as G}from"./ClosePopup.fe3d38cd.js";import"./QMenu.57c1c791.js";import"./QList.1ee087a7.js";const R={name:"ClientsIndex",data(){return{columns:[{name:"option",label:"Opciones",align:"left",field:l=>l.option},{name:"id",label:"ID",align:"left",field:l=>l.id},{name:"name",label:"Nombre",align:"left",field:l=>l.name},{name:"username",label:"Usuario",align:"left",field:l=>l.username},{name:"role",label:"Rol",align:"left",field:l=>l.role},{name:"estudiantes",label:"Estudiantes",align:"left",field:l=>l.estudiantes},{name:"colegio",label:"Colegio",align:"left",field:l=>{var a;return(a=l.colegio)==null?void 0:a.nombre}}],roles:[{label:"Admin",value:"ADMIN"},{label:"Apoderado",value:"APODERADO"},{label:"Encargado PIE",value:"ENCARGADO PIE"},{label:"Docente",value:"DOCENTE"},{label:"Asistente Educativo",value:"ASISTENTE EDUCATIVO"}],loading:!1,users:[],user:{},userDialog:!1,clienDialogHistory:!1,filter:"",passwordShow:!1,colegios:[]}},mounted(){this.userGet(),this.colegioGet()},methods:{colegioGet(){this.loading=!0,this.$axios.get("colegios").then(l=>{this.colegios=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},userSave(){this.loading=!0,this.user.id?this.$axios.put(`users/${this.user.id}`,this.user).then(l=>{this.userDialog=!1;const a=this.users.findIndex(n=>n.id===this.user.id);this.users.splice(a,1,l.data)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1}):this.$axios.post("users",this.user).then(l=>{this.userDialog=!1,this.users.unshift(l.data)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},userChangePassword(l){this.$alert.promptPassword("Ingrese la nueva contrase\xF1a").onOk(a=>{this.loading=!0,this.$axios.put(`passwordUpdate/${l.id}`,{password:a}).then(n=>{this.$alert.success("Contrase\xF1a cambiada con \xE9xito")}).catch(n=>{this.$alert.error(n.response.data.message)}).finally(()=>{this.loading=!1})})},userDelete(l){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este usere?").onOk(()=>{this.loading=!0,this.$axios.delete(`users/${l.id}`).then(a=>{const n=this.users.findIndex(b=>b.id===b.id);this.users.splice(n,1)}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})})},userEdit(l){this.userDialog=!0,this.user={...l}},userAdd(){this.userDialog=!0,this.user={name:"",ci:""}},userGet(){this.loading=!0,this.$axios.get("users").then(l=>{this.users=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})}}},B={class:"mp-0"},z={class:"text-h6"},F={class:"row"},L={class:"col-12"},M={class:"col-12"},H={class:"col-12"},W={class:"col-12"},Y={class:"col-12"};function Z(l,a,n,b,o,m){return g(),C(q,{class:"bg-grey-3 q-pa-md"},{default:i(()=>[s(O,{rows:o.users,columns:o.columns,title:"Usuarios","rows-per-page-options":[0],"row-key":"id",dense:"",filter:o.filter,loading:o.loading},{"body-cell-option":i(e=>[s(h,{"auto-width":""},{default:i(()=>[s(d,{flat:"",dense:"",icon:"edit",onClick:t=>m.userEdit(e.row)},{default:i(()=>[s(c,null,{default:i(()=>[u("Editar")]),_:1})]),_:2},1032,["onClick"]),s(d,{flat:"",dense:"",icon:"delete",onClick:t=>m.userDelete(e.row)},{default:i(()=>[s(c,null,{default:i(()=>[u("Eliminar")]),_:1})]),_:2},1032,["onClick"]),s(d,{flat:"",dense:"",icon:"vpn_key",onClick:t=>m.userChangePassword(e.row)},{default:i(()=>[s(c,null,{default:i(()=>[u("Cambiar Contrase\xF1a")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),"body-cell-role":i(e=>[s(h,{props:e},{default:i(()=>[s(V,{dense:"","text-color":"white",style:_(`background-color: ${e.row.role==="ADMIN"?"red":e.row.role==="APODERADO"?"indigo":e.row.role==="ENCARGADO PIE"?"green":e.row.role==="DOCENTE"?"orange":"blue"}`)},{default:i(()=>[u(f(e.row.role),1)]),_:2},1032,["style"])]),_:2},1032,["props"])]),"top-right":i(()=>[s(d,{outline:"",dense:"",icon:"add_circle",onClick:m.userAdd,label:"Agregar","no-caps":"",loading:o.loading},{default:i(()=>[s(c,null,{default:i(()=>[u("Agregar")]),_:1})]),_:1},8,["onClick","loading"]),s(p,{modelValue:o.filter,"onUpdate:modelValue":a[0]||(a[0]=e=>o.filter=e),dense:"",class:"q-ml-md",debounce:"300",placeholder:"Buscar",outlined:"",clearable:""},{append:i(()=>[s(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-colegio":i(e=>[s(h,{"auto-width":""},{default:i(()=>{var t;return[s(V,{dense:"","text-color":"white",style:_(`background-color: #${(t=e.row.colegio)==null?void 0:t.color}`)},{default:i(()=>{var w;return[u(f((w=e.row.colegio)==null?void 0:w.nombre),1)]}),_:2},1032,["style"])]}),_:2},1024)]),"body-cell-estudiantes":i(e=>[s(h,{"auto-width":""},{default:i(()=>[r("ul",B,[(g(!0),y(k,null,Q(e.row.students,t=>(g(),y("li",{class:"pm-0",key:t.id},f(l.$filters.capitalize(t.name)),1))),128))])]),_:2},1024)]),_:1},8,["rows","columns","filter","loading"]),s(U,{modelValue:o.userDialog,"onUpdate:modelValue":a[8]||(a[8]=e=>o.userDialog=e),persistent:""},{default:i(()=>[s(A,{style:{width:"250px","max-width":"90vw"}},{default:i(()=>[s(D,{class:"row items-center q-pb-none"},{default:i(()=>[r("div",z,f(o.user.id?"Editar":"Agregar")+" Cliente",1),s(P),s(d,{flat:"",dense:"",icon:"close",onClick:a[1]||(a[1]=e=>o.userDialog=!1)})]),_:1}),s(T,{onSubmit:m.userSave},{default:i(()=>[s(D,null,{default:i(()=>[r("div",F,[r("div",L,[s(p,{modelValue:o.user.name,"onUpdate:modelValue":a[2]||(a[2]=e=>o.user.name=e),label:"Nombre",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),r("div",M,[s(p,{modelValue:o.user.username,"onUpdate:modelValue":a[3]||(a[3]=e=>o.user.username=e),label:"Usuario",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),r("div",H,[o.user.id?S("",!0):(g(),C(p,{key:0,modelValue:o.user.password,"onUpdate:modelValue":a[5]||(a[5]=e=>o.user.password=e),label:"Contrase\xF1a",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"],type:o.passwordShow?"text":"password"},{append:i(()=>[s(v,{name:o.passwordShow?"visibility":"visibility_off",onClick:a[4]||(a[4]=e=>o.passwordShow=!o.passwordShow)},null,8,["name"])]),_:1},8,["modelValue","rules","type"]))]),r("div",W,[s(E,{modelValue:o.user.role,"onUpdate:modelValue":a[6]||(a[6]=e=>o.user.role=e),label:"Rol",outlined:"",dense:"",options:o.roles,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"])]),r("div",Y,[s(E,{modelValue:o.user.colegio_id,"onUpdate:modelValue":a[7]||(a[7]=e=>o.user.colegio_id=e),label:"Colegio",outlined:"",dense:"",options:o.colegios,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options","rules"])])])]),_:1}),s(I,{align:"right"},{default:i(()=>[N(s(d,{flat:"",label:"Cancelar",loading:o.loading},null,8,["loading"]),[[G]]),s(d,{color:"primary",label:"Guardar",type:"submit",loading:o.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ie=x(R,[["render",Z]]);export{ie as default};
