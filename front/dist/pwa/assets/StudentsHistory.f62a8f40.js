import{_ as E,Q as h,R as g,S as n,T as o,V as e,U as m,$ as b,a0 as k,a1 as V,aA as _,aB as f,aD as p,Z as w,aE as U,aF as O,W as a,Y as x,P as S,ba as y,am as P}from"./index.f3d2fd78.js";import{Q as C,d as L,b as F,a as R,f as T}from"./QForm.c65886f8.js";import{Q}from"./QBtnGroup.6072c375.js";import{a as I,c as D,d as A}from"./format.96ace5aa.js";import{Q as M}from"./QPage.4b7f6b2a.js";import"./position-engine.8cb16452.js";const H={props:{student_id:{type:Number,required:!0}},data(){return{loading:!1,documentsSelect:["AUTORIZACI\xD3N PARA EL ABORDAJE DEC.","CERTIFICADO PARA EL EMPLEADOR","CONTRATO DE CONTIGENCIAS","FICHA DEL PLAN DE APOYO INDIVIDUALIZADO (PAI) PARA ESTUDIANTES CON TEA","PLAN DE ACOMPA\xD1AMIENTO EMOCIONAL Y CONDUCTUAL","FICHA DE SEGUIMIENTO INDIVIDUALIZADA PARA DESREGULACI\xD3N EMOCIONAL"],documentDialog:!1,document:{},documents:[]}},mounted(){this.documentsGet()},methods:{documentDelete(s){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este document?").onOk(()=>{this.loading=!0,this.$axios.delete(`documents/${s.id}`).then(t=>{this.$alert.success("Documento eliminado"),this.documentsGet()}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})})},documentOpen(s){this.loading=!0,this.$axios.get(`documents/${s.id}/download`,{responseType:"blob"}).then(t=>{const u=window.URL.createObjectURL(new Blob([t.data],{type:"application/pdf"})),r=window.document.createElement("a");r.href=u,r.setAttribute("download",`${s.description}.pdf`),window.document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(u)}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},documentsGet(){this.loading=!0,this.$axios.get("documents",{params:{student_id:this.student_id}}).then(s=>{this.documents=s.data,console.log(this.documents)}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})},documentForm(){this.loading=!0,this.$axios.post("documents",{student_id:this.student_id,document:this.document}).then(s=>{this.$alert.success("Documento agregado"),this.documentDialog=!1,this.documentsGet()}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})},addDocument(){this.documentDialog=!0,this.document={}}}},q={class:"row items-center"},G=e("div",{class:"text-h6 text-bold"},"Documentos",-1),B=e("thead",null,[e("tr",null,[e("th",null,"Opciones"),e("th",null,"Fecha"),e("th",null,"Documento"),e("th",null,"Usuario")])],-1),z=e("div",{class:"text-h6 text-bold"},"Agregar Documento",-1),Y={key:1,class:"row"},Z={class:"col-12"},j={class:"col-12 col-md-4"},J={class:"col-12 col-md-4"},W={class:"col-12 col-md-4"},K={class:"col-6 col-md-3"},X={class:"col-6 col-md-3"},$={class:"col-6 col-md-3"},ee={class:"col-6 col-md-3"};function te(s,t,u,r,l,c){return h(),g(f,null,{default:n(()=>[o(_,null,{default:n(()=>[e("div",q,[G,o(C),o(m,{icon:"add_circle_outline",onClick:c.addDocument,label:"Agregar","no-caps":"",color:"indigo",dense:"",size:"10px",loading:l.loading},null,8,["onClick","loading"])]),o(L,{dense:"","wrap-cells":""},{default:n(()=>[B,e("tbody",null,[(h(!0),b(V,null,k(l.documents,i=>{var d;return h(),b("tr",{key:i.id},[e("td",null,[o(m,{icon:"edit",flat:"",round:"",dense:"",color:"primary",loading:l.loading},null,8,["loading"]),o(m,{icon:"delete",flat:"",round:"",dense:"",color:"negative",onClick:v=>c.documentDelete(i),loading:l.loading},null,8,["onClick","loading"])]),e("td",null,a(s.$filters.formatdMYHMS(i.date)),1),e("td",null,[o(m,{flat:"",dense:"",onClick:v=>c.documentOpen(i),icon:"fa-solid fa-file",size:"12px",color:"blue-9",loading:l.loading},null,8,["onClick","loading"]),x(" "+a(i.description),1)]),e("td",null,a((d=i.user)==null?void 0:d.name),1)])}),128))])]),_:1})]),_:1}),o(O,{modelValue:l.documentDialog,"onUpdate:modelValue":t[12]||(t[12]=i=>l.documentDialog=i),persistent:""},{default:n(()=>[o(f,{style:{width:"750px","max-width":"90vw",height:"90vh","max-height":"90vh"}},{default:n(()=>[o(_,{class:"row items-center q-pb-none"},{default:n(()=>[z,o(C),o(m,{icon:"close",flat:"",round:"",dense:"",onClick:t[0]||(t[0]=i=>l.documentDialog=!1)})]),_:1}),o(_,null,{default:n(()=>[o(F,{modelValue:l.document.name,"onUpdate:modelValue":t[1]||(t[1]=i=>l.document.name=i),options:l.documentsSelect,label:"Seleccionar Documento",outlined:"",dense:""},null,8,["modelValue","options"]),o(R,{onSubmit:c.documentForm},{default:n(()=>[l.document.name==="AUTORIZACI\xD3N PARA EL ABORDAJE DEC."?(h(),g(p,{key:0,label:"Descripci\xF3n",modelValue:l.document.description,"onUpdate:modelValue":t[2]||(t[2]=i=>l.document.description=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])):l.document.name==="CERTIFICADO PARA EL EMPLEADOR"?(h(),b("div",Y,[e("div",Z,[o(p,{label:"Descripci\xF3n",modelValue:l.document.description,"onUpdate:modelValue":t[3]||(t[3]=i=>l.document.description=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])]),e("div",j,[o(p,{label:"Etapa Inicial",modelValue:l.document.etapa_inial,"onUpdate:modelValue":t[4]||(t[4]=i=>l.document.etapa_inial=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])]),e("div",J,[o(p,{label:"Aumento",modelValue:l.document.aumento,"onUpdate:modelValue":t[5]||(t[5]=i=>l.document.aumento=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])]),e("div",W,[o(p,{label:"Crisis",modelValue:l.document.crisis,"onUpdate:modelValue":t[6]||(t[6]=i=>l.document.crisis=i),outlined:"",dense:"",type:"textarea"},null,8,["modelValue"])]),e("div",K,[o(p,{label:"Hora Inicio",modelValue:l.document.hora_inicio,"onUpdate:modelValue":t[7]||(t[7]=i=>l.document.hora_inicio=i),outlined:"",dense:"",type:"time"},null,8,["modelValue"])]),e("div",X,[o(p,{label:"Hora Llamada",modelValue:l.document.hora_llamada,"onUpdate:modelValue":t[8]||(t[8]=i=>l.document.hora_llamada=i),outlined:"",dense:"",type:"time"},null,8,["modelValue"])]),e("div",$,[o(p,{label:"Hora Llegada",modelValue:l.document.hora_llegada,"onUpdate:modelValue":t[9]||(t[9]=i=>l.document.hora_llegada=i),outlined:"",dense:"",type:"time"},null,8,["modelValue"])]),e("div",ee,[o(p,{label:"Hora Termino",modelValue:l.document.hora_termino,"onUpdate:modelValue":t[10]||(t[10]=i=>l.document.hora_termino=i),outlined:"",dense:"",type:"time"},null,8,["modelValue"])])])):w("",!0),o(U,{align:"right"},{default:n(()=>[o(m,{label:"Cancelar",color:"negative",onClick:t[11]||(t[11]=i=>l.documentDialog=!1),loading:l.loading,icon:"close","no-caps":""},null,8,["loading"]),o(m,{label:"Guardar",color:"primary",type:"submit",loading:l.loading,icon:"save","no-caps":""},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var le=E(H,[["render",te]]);const oe={name:"StudentsHistory",components:{StudentsDocuments:le},data(){return{student_id:this.$route.params.id,student:{},process:0,textProcess:"",loading:!1,historyDialog:!1,history:{description:""}}},mounted(){this.student_id=this.$route.params.id,this.studentGet()},methods:{deleteHistory(s){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este historial?").onOk(()=>{this.loading=!0,this.$axios.delete(`history/${s}`).then(t=>{const u=this.student.histories.findIndex(r=>r.id===s);this.student.histories.splice(u,1)}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})})},historyClick(s){this.history={...s},this.historyDialog=!0},historyForm(){this.loading=!0,this.history.student_id=this.student_id,this.$axios.post("history/",this.history).then(s=>{this.student.histories.unshift(s.data),this.historyDialog=!1}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})},addHistory(){this.historyDialog=!0,this.history.id=void 0,this.history.description=""},handleDrop(s){s.preventDefault();const t=s.dataTransfer.files;this.processFiles(t)},processFiles(s){this.fileUpload(s)},uploadFile(){this.$refs.fileInput.click()},fileUpload(){const s=new FormData;s.append("file",this.$refs.fileInput.files[0]),s.append("student_id",this.student_id);const t={onUploadProgress:u=>{const r=Math.round(u.loaded*100/u.total);this.textProcess=r+"% completado",this.process=r/100}};this.$axios.post(`students/${this.student_id}/diagnoses`,s,t).then(u=>{this.student.diagnoses.unshift(u.data)}).catch(u=>{this.$alert.error(u.response.data.message)}).finally(()=>{this.$refs.fileInput.value="",this.textProcess=""})},studentGet(){this.$axios.get(`students/${this.student_id}`).then(s=>{this.student=s.data}).catch(s=>{this.$alert.error(s.response.data.message)})},downloadFile(s){this.loading=!0,this.$axios.get(`diagnoses/${s.id}/download`,{responseType:"blob"}).then(t=>{const u=window.URL.createObjectURL(new Blob([t.data],{type:t.headers["content-type"]})),r=document.createElement("a");r.href=u,r.setAttribute("download",s.name),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(u)}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},deleteDiagnosis(s){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este diagn\xF3stico?").onOk(()=>{this.loading=!0,this.$axios.delete(`diagnoses/${s}`).then(t=>{const u=this.student.diagnoses.findIndex(r=>r.id===s);this.student.diagnoses.splice(u,1)}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})})}}},se={class:"row"},ne={class:"col-12 col-md-3"},ie=e("label",{class:"text-bold"},"Rut",-1),de={class:"col-12 col-md-9"},ae=e("label",{class:"text-bold"},"Nombre Completo",-1),re={class:"col-6 col-md-3"},ue=e("label",{class:"text-bold"},"Rut Tutor",-1),ce={class:"col-6 col-md-9"},me=e("label",{class:"text-bold"},"Nombre Tutor",-1),he={class:"col-6 col-md-3"},pe=e("label",{class:"text-bold"},"Fecha de Nacimiento",-1),_e={class:"col-6 col-md-3"},fe=e("label",{class:"text-bold"},"A\xF1o ingreso PIE",-1),ge={class:"col-6 col-md-3"},ve=e("label",{class:"text-bold"},"Curso",-1),be={class:"col-6 col-md-3"},ye=e("label",{class:"text-bold"},"A\xF1o",-1),De={class:"col-12"},xe=e("label",{class:"text-bold"},"Direcci\xF3n",-1),Ce={class:"col-6 col-md-6"},Ae=e("label",{class:"text-bold"},"Celular",-1),ke={class:"col-6 col-md-6"},Ve=e("label",{class:"text-bold"},"Sexo",-1),Ie={class:"row"},Ee={class:"col-12 col-md-8"},we={class:"row"},Ue={class:"col-12"},Oe={class:"row items-center"},Le=e("div",{class:"text-h6 text-bold"},"Historial",-1),Re=e("thead",null,[e("tr",null,[e("th",null,"Opciones"),e("th",null,"Fecha"),e("th",null,"Descripci\xF3n"),e("th",null,"Usuario")])],-1),Ne={class:"col-12"},Se={class:"col-12 col-md-4"},Pe=e("div",{class:"text-h6"},"Diagn\xF3sticos",-1),Fe=e("div",null,"Ac\xE1 suba sus archivos",-1),Te={class:"q-mt-md"},Qe={class:"text-h6"};function Me(s,t,u,r,l,c){const i=S("StudentsDocuments");return h(),g(M,{class:"bg-grey-3 q-pa-md"},{default:n(()=>[o(f,{class:"q-mb-md"},{default:n(()=>[o(_,null,{default:n(()=>[e("div",se,[e("div",ne,[ie,e("div",null,a(l.student.rut),1)]),e("div",de,[ae,e("div",null,a(l.student.name),1)]),e("div",re,[ue,e("div",null,a(l.student.tutorRut),1)]),e("div",ce,[me,e("div",null,a(l.student.tutorName),1)]),e("div",he,[pe,e("div",null,a(l.student.birthdate),1)]),e("div",_e,[fe,e("div",null,a(l.student.year_PIE),1)]),e("div",ge,[ve,e("div",null,a(l.student.course),1)]),e("div",be,[ye,e("div",null,a(l.student.year),1)]),e("div",De,[xe,e("div",null,a(l.student.address),1)]),e("div",Ce,[Ae,e("div",null,a(l.student.phone),1)]),e("div",ke,[Ve,e("div",null,a(l.student.sex==="M"?"Masculino":"Femenino"),1)])])]),_:1})]),_:1}),e("div",Ie,[e("div",Ee,[e("div",we,[e("div",Ue,[o(f,null,{default:n(()=>[o(_,null,{default:n(()=>[e("div",Oe,[Le,o(C),o(m,{icon:"add_circle_outline",onClick:c.addHistory,label:"Agregar","no-caps":"",color:"green",dense:"",size:"10px"},null,8,["onClick"])]),o(L,{dense:"","wrap-cells":""},{default:n(()=>[Re,e("tbody",null,[(h(!0),b(V,null,k(l.student.histories,d=>{var v;return h(),b("tr",{key:d.id},[e("td",null,[o(Q,{rounded:""},{default:n(()=>[o(m,{flat:"",icon:"edit",class:"q-pa-xs",size:"10px",onClick:N=>c.historyClick(d)},null,8,["onClick"]),o(m,{flat:"",icon:"delete",class:"q-pa-xs",size:"10px",onClick:N=>c.deleteHistory(d.id)},null,8,["onClick"])]),_:2},1024)]),e("td",null,a(s.$filters.formatdMY(d.date)),1),e("td",null,a(d.description),1),e("td",null,a((v=d.user)==null?void 0:v.name),1)])}),128))])]),_:1})]),_:1})]),_:1})]),e("div",Ne,[o(i,{student_id:parseInt(l.student_id)},null,8,["student_id"])])])]),e("div",Se,[o(f,null,{default:n(()=>[o(_,null,{default:n(()=>[Pe,e("div",{class:"text-center border-dashed cursor-pointer",onClick:t[0]||(t[0]=(...d)=>c.uploadFile&&c.uploadFile(...d)),onDragenter:t[1]||(t[1]=y(()=>{},["prevent"])),onDragover:t[2]||(t[2]=y(()=>{},["prevent"])),onDragleave:t[3]||(t[3]=y(()=>{},["prevent"])),onDrop:t[4]||(t[4]=y((...d)=>c.handleDrop&&c.handleDrop(...d),["prevent"]))},[o(P,{name:"cloud_upload",size:"70px"}),Fe],32),e("input",{type:"file",class:"hidden",ref:"fileInput",onChange:t[5]||(t[5]=(...d)=>c.fileUpload&&c.fileUpload(...d)),accept:".pdf"},null,544),e("div",Te,[o(f,null,{default:n(()=>[o(_,{class:"q-pa-none"},{default:n(()=>[l.textProcess!==""?(h(),g(I,{key:0},{default:n(()=>[o(D,null,{default:n(()=>[o(A,null,{default:n(()=>[x(a(l.textProcess),1)]),_:1}),o(T,{value:l.process,color:l.process===100?"green":"primary"},null,8,["value","color"])]),_:1}),o(D,{side:""},{default:n(()=>[o(m,{flat:"",icon:"picture_as_pdf"})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),(h(!0),b(V,null,k(l.student.diagnoses,d=>(h(),g(f,{key:d.id,flat:"",bordered:"",class:"q-ma-sm"},{default:n(()=>[o(_,{class:"q-pa-none bg-grey-3"},{default:n(()=>[o(I,null,{default:n(()=>[o(D,{clickable:""},{default:n(()=>[o(A,{class:"text-bold"},{default:n(()=>[x(a(s.$filters.formatdMY(d.created_at))+" ",1),o(m,{flat:"",icon:"fa-regular fa-file-pdf",dense:"",class:"q-pa-none",color:"red",size:"10px",onClick:v=>c.downloadFile(d),loading:l.loading},null,8,["onClick","loading"])]),_:2},1024),o(A,{class:"text-capitalize text-caption"},{default:n(()=>[x(a(d.name),1)]),_:2},1024)]),_:2},1024),o(D,{side:""},{default:n(()=>[o(m,{flat:"",icon:"delete",onClick:v=>c.deleteDiagnosis(d.id),color:"red",loading:l.loading},null,8,["onClick","loading"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})]),_:1})])]),o(O,{modelValue:l.historyDialog,"onUpdate:modelValue":t[9]||(t[9]=d=>l.historyDialog=d)},{default:n(()=>[o(f,{style:{width:"400px","max-width":"90vw"}},{default:n(()=>[o(_,{class:"row items-center q-pb-none"},{default:n(()=>[e("div",Qe,a(l.history.id?"Editar":"Agregar")+" Historial ",1),o(C),o(m,{flat:"",icon:"close",onClick:t[6]||(t[6]=d=>l.historyDialog=!1)})]),_:1}),o(_,null,{default:n(()=>[o(R,{class:"q-gutter-md",onSubmit:c.historyForm},{default:n(()=>[o(p,{type:"textarea",modelValue:l.history.description,"onUpdate:modelValue":t[7]||(t[7]=d=>l.history.description=d),label:"Descripci\xF3n",outlined:"",rules:[d=>!!d||"Campo requerido"]},null,8,["modelValue","rules"]),o(U,{align:"right"},{default:n(()=>[o(m,{label:"Cancelar",color:"red",onClick:t[8]||(t[8]=d=>l.historyDialog=!1),"no-caps":"",icon:"close",loading:l.loading},null,8,["loading"]),l.history.id===void 0?(h(),g(m,{key:0,label:"Guardar",color:"green",type:"submit","no-caps":"",icon:"save",loading:l.loading},null,8,["loading"])):(h(),g(m,{key:1,label:"Modificar",color:"orange",type:"submit","no-caps":"",icon:"save",loading:l.loading},null,8,["loading"]))]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ze=E(oe,[["render",Me]]);export{Ze as default};
