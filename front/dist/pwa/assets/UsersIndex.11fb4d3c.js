import{Q as c}from"./use-fullscreen.32c872ec.js";import{_ as x,Q as w,R as C,S as a,T as s,U as t,Y as d,Z as _,W as p,aN as g,au as v,aD as E,aC as D,V as n,a2 as Q,aO as A,L as k,aP as S}from"./index.aef267af.js";import{Q as h,a as I}from"./QTable.a3bdbcaf.js";import{Q as y}from"./format.697b557e.js";import{Q as N}from"./QSpace.e5f33dd8.js";import{Q as U,a as V}from"./QForm.496111f3.js";import{Q as O}from"./QPage.3151911e.js";import{C as P}from"./ClosePopup.e63730ab.js";import"./QMenu.2ff95139.js";import"./QList.9a06d01a.js";const T={name:"ClientsIndex",data(){return{columns:[{name:"option",label:"Opciones",align:"left",field:l=>l.option},{name:"id",label:"ID",align:"left",field:l=>l.id},{name:"name",label:"Nombre",align:"left",field:l=>l.name},{name:"username",label:"Usuario",align:"left",field:l=>l.username},{name:"role",label:"Rol",align:"left",field:l=>l.role},{name:"colegio",label:"Colegio",align:"left",field:l=>{var i;return(i=l.colegio)==null?void 0:i.nombre}}],roles:[{label:"Admin",value:"ADMIN"},{label:"Apoderado",value:"APODERADO"},{label:"Encargado PIE",value:"ENCARGADO PIE"},{label:"Docente",value:"DOCENTE"},{label:"Asistente Educativo",value:"ASISTENTE EDUCATIVO"}],loading:!1,users:[],user:{},userDialog:!1,clienDialogHistory:!1,filter:"",passwordShow:!1,colegios:[]}},mounted(){this.userGet(),this.colegioGet()},methods:{colegioGet(){this.loading=!0,this.$axios.get("colegios").then(l=>{this.colegios=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},userSave(){this.loading=!0,this.user.id?this.$axios.put(`users/${this.user.id}`,this.user).then(l=>{this.userDialog=!1;const i=this.users.findIndex(r=>r.id===this.user.id);this.users.splice(i,1,l.data)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1}):this.$axios.post("users",this.user).then(l=>{this.userDialog=!1,this.users.unshift(l.data)}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})},userChangePassword(l){this.$alert.promptPassword("Ingrese la nueva contrase\xF1a").onOk(i=>{this.loading=!0,this.$axios.put(`passwordUpdate/${l.id}`,{password:i}).then(r=>{this.$alert.success("Contrase\xF1a cambiada con \xE9xito")}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})})},userDelete(l){this.$alert.confirm("\xBFEst\xE1 seguro de eliminar este usere?").onOk(()=>{this.loading=!0,this.$axios.delete(`users/${l.id}`).then(i=>{const r=this.users.findIndex(f=>f.id===f.id);this.users.splice(r,1)}).catch(i=>{this.$alert.error(i.response.data.message)}).finally(()=>{this.loading=!1})})},userEdit(l){this.userDialog=!0,this.user={...l}},userAdd(){this.userDialog=!0,this.user={name:"",ci:""}},userGet(){this.loading=!0,this.$axios.get("users").then(l=>{this.users=l.data}).catch(l=>{this.$alert.error(l.response.data.message)}).finally(()=>{this.loading=!1})}}},q={class:"text-h6"},G={class:"row"},R={class:"col-12"},B={class:"col-12"},M={class:"col-12"},z={class:"col-12"},F={class:"col-12"};function H(l,i,r,f,o,u){return w(),C(O,{class:"bg-grey-3 q-pa-md"},{default:a(()=>[s(I,{rows:o.users,columns:o.columns,title:"Usuarios","rows-per-page-options":[0],"row-key":"id",dense:"",filter:o.filter,loading:o.loading},{"body-cell-option":a(e=>[s(h,{"auto-width":""},{default:a(()=>[s(t,{flat:"",dense:"",icon:"edit",onClick:m=>u.userEdit(e.row)},{default:a(()=>[s(c,null,{default:a(()=>[d("Editar")]),_:1})]),_:2},1032,["onClick"]),s(t,{flat:"",dense:"",icon:"delete",onClick:m=>u.userDelete(e.row)},{default:a(()=>[s(c,null,{default:a(()=>[d("Eliminar")]),_:1})]),_:2},1032,["onClick"]),s(t,{flat:"",dense:"",icon:"vpn_key",onClick:m=>u.userChangePassword(e.row)},{default:a(()=>[s(c,null,{default:a(()=>[d("Cambiar Contrase\xF1a")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),"body-cell-role":a(e=>[s(h,{props:e},{default:a(()=>[s(y,{dense:"","text-color":"white",style:_(`background-color: ${e.row.role==="ADMIN"?"red":e.row.role==="APODERADO"?"indigo":e.row.role==="ENCARGADO PIE"?"green":e.row.role==="DOCENTE"?"orange":"blue"}`)},{default:a(()=>[d(p(e.row.role),1)]),_:2},1032,["style"])]),_:2},1032,["props"])]),"top-right":a(()=>[s(t,{outline:"",dense:"",icon:"add_circle",onClick:u.userAdd,label:"Agregar","no-caps":"",loading:o.loading},{default:a(()=>[s(c,null,{default:a(()=>[d("Agregar")]),_:1})]),_:1},8,["onClick","loading"]),s(g,{modelValue:o.filter,"onUpdate:modelValue":i[0]||(i[0]=e=>o.filter=e),dense:"",class:"q-ml-md",debounce:"300",placeholder:"Buscar",outlined:"",clearable:""},{append:a(()=>[s(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-colegio":a(e=>[s(h,{"auto-width":""},{default:a(()=>{var m;return[s(y,{dense:"","text-color":"white",style:_(`background-color: #${(m=e.row.colegio)==null?void 0:m.color}`)},{default:a(()=>{var b;return[d(p((b=e.row.colegio)==null?void 0:b.nombre),1)]}),_:2},1032,["style"])]}),_:2},1024)]),_:1},8,["rows","columns","filter","loading"]),s(S,{modelValue:o.userDialog,"onUpdate:modelValue":i[8]||(i[8]=e=>o.userDialog=e),persistent:""},{default:a(()=>[s(E,{style:{width:"250px","max-width":"90vw"}},{default:a(()=>[s(D,{class:"row items-center q-pb-none"},{default:a(()=>[n("div",q,p(o.user.id?"Editar":"Agregar")+" Cliente",1),s(N),s(t,{flat:"",dense:"",icon:"close",onClick:i[1]||(i[1]=e=>o.userDialog=!1)})]),_:1}),s(U,{onSubmit:u.userSave},{default:a(()=>[s(D,null,{default:a(()=>[n("div",G,[n("div",R,[s(g,{modelValue:o.user.name,"onUpdate:modelValue":i[2]||(i[2]=e=>o.user.name=e),label:"Nombre",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",B,[s(g,{modelValue:o.user.username,"onUpdate:modelValue":i[3]||(i[3]=e=>o.user.username=e),label:"Usuario",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"])]),n("div",M,[o.user.id?Q("",!0):(w(),C(g,{key:0,modelValue:o.user.password,"onUpdate:modelValue":i[5]||(i[5]=e=>o.user.password=e),label:"Contrase\xF1a",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"],type:o.passwordShow?"text":"password"},{append:a(()=>[s(v,{name:o.passwordShow?"visibility":"visibility_off",onClick:i[4]||(i[4]=e=>o.passwordShow=!o.passwordShow)},null,8,["name"])]),_:1},8,["modelValue","rules","type"]))]),n("div",z,[s(V,{modelValue:o.user.role,"onUpdate:modelValue":i[6]||(i[6]=e=>o.user.role=e),label:"Rol",outlined:"",dense:"",options:o.roles,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"])]),n("div",F,[s(V,{modelValue:o.user.colegio_id,"onUpdate:modelValue":i[7]||(i[7]=e=>o.user.colegio_id=e),label:"Colegio",outlined:"",dense:"",options:o.colegios,rules:[e=>!!e||"Campo requerido"],"emit-value":"","map-options":"","option-value":"id","option-label":"nombre"},null,8,["modelValue","options","rules"])])])]),_:1}),s(A,{align:"right"},{default:a(()=>[k(s(t,{flat:"",label:"Cancelar",loading:o.loading},null,8,["loading"]),[[P]]),s(t,{color:"primary",label:"Guardar",type:"submit",loading:o.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var le=x(T,[["render",H]]);export{le as default};
